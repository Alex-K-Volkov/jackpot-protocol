!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).EthersWeb3Modal={})}((this,(function(e){"use strict";const t="3.1.0",o={};Object.defineProperty(o,"__esModule",{value:!0}),o.EthersWeb3Modal=void 0;var r=function(e,t){if(e&&"object"==typeof e){var o={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(o[r]=e[r]);return o}return{}};const s={};Object.defineProperty(s,"__esModule",{value:!0}),s.formatAddress=s.getCaipAddress=s.getCaipDefaultChain=void 0,s.getCaipDefaultChain=function(e){return e?.isV2?e.chains?.[0]:void 0},s.getCaipAddress=function(e){const{address:t,chain:o}=e;return t&&o?`${o.namespace}:${o.id}:${t}`:void 0},s.formatAddress=function(e){return e.slice(0,6)+"..."+e.slice(e.length-4)},Object.freeze(s);const n={};Object.defineProperty(n,"__esModule",{value:!0}),n.formatChainAsNum=n.getCaipChainId=n.isCaipChainId=void 0,n.isCaipChainId=function(e){return e.includes(":")},n.getCaipChainId=function(e){if(!e)return;const[t,o]=e.split(":");return t&&o?`${t}:${o}`:void 0},n.formatChainAsNum=function(e){return Number(e.split(":")[1])},Object.freeze(n);class a{constructor(e,t){this.ethersConfig=e,this.projectId=t,this.createUniversalProvider=async()=>{const{UniversalProvider:e}=await import("@walletconnect/universal-provider");return e.init({projectId:this.projectId,metadata:this.ethersConfig.metadata})},this.createWeb3Modal=async(e)=>{const{Web3Modal:t}=await import("@web3modal/standalone");return new t({walletConnectVersion:2,projectId:this.projectId,walletImages:e,enableExplorer:!0})},this.getWalletConnectProvider=async()=>this.walletConnectProvider?this.walletConnectProvider:(this.walletConnectProvider=await this.createUniversalProvider(),this.walletConnectProvider),this.getWeb3Modal=async(e)=>this.web3Modal?this.web3Modal:this.getWalletConnectProvider().then(async t=>{const o=await t.getMetaMaskProvider();return this.web3Modal=await this.createWeb3Modal(o?.getWalletImages?.()),this.web3Modal}),this.getEthersProvider=()=>{const e=this.ethersConfig.ethers,t=this.ethersConfig.wallet||this.walletConnectProvider;if(!e)throw new Error("ethers package not found");if(this.ethersConfig.handler)return new this.ethersConfig.handler(t);return new e.providers.Web3Provider(t)},this.subscribeProvider=e=>{this.getWalletConnectProvider().then(t=>{t.on("display_uri",e),t.on("session_ping",e),t.on("session_event",e),t.on("session_update",e),t.on("session_delete",e),t.on("user_disconnect",e),t.on("connect",e),t.on("disconnect",e),t.on("accountsChanged",e),t.on("chainChanged",e),t.on("message",e)}).catch(t=>{console.error("Error subscribing to provider events",t),e({type:"subscibe_error",data:t})})},this.connect=async e=>{const t=await this.getWalletConnectProvider();return t.connect(e)},this.disconnect=async()=>{const e=await this.getWalletConnectProvider();return e.disconnect()},this.open=async(e,t)=>{const o=await this.getWeb3Modal();await o.openModal({route:e,standaloneChains:t})},this.close=async()=>{const e=await this.getWeb3Modal();e.closeModal()},this.getAccount=async()=>{const e=await this.getWalletConnectProvider(),t=(await e.getAccounts())[0];return{address:t,isConnected:!!t}},this.getChainId=async()=>{const e=await this.getWalletConnectProvider(),t=e.session?.namespaces;return n.formatChainAsNum(t?Object.keys(t)[0]:void 0)},this.getIsConnected=async()=>{const e=await this.getWalletConnectProvider(),t=e.session;return{isConnected:!!t}},this.getSigner=()=>{const e=this.getEthersProvider();return e.getSigner()},this.getWalletProvider=()=>(this.getWalletConnectProvider(),this.ethersConfig.wallet||this.walletConnectProvider),this.walletConnectProvider=void 0,this.web3Modal=void 0}return e.EthersWeb3Modal=a,e.VERSION=t,Object.defineProperty(e,"__esModule",{value:!0}),e}));
